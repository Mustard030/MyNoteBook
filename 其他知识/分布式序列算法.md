在微服务架构中，往往需要对大量数据和消息进行唯一标识。随着系统的复杂，数据的增多，分库分表成为了常见方案，对数据库分表后需要有一个唯一的ID来标识一条数据或消息（如订单号、交易流水、事件编号等）。

这个ID必须是全局唯一的，并且主键应尽可能保持有序，这样会大大提升索引的查询效率。



# 雪花算法（SNOWFLAKE）

他会生成一个64bit大小的整形ID，int不足以存放

![image-20220415150713707](https://image.itbaima.cn/markdown/2023/03/07/lU9A4zjSIKvaxwh.jpg)

可以看到它主要是三个部分组成，时间+工作机器ID+序列号，时间以毫秒为单位，41个bit位能表示约70年的时间，时间纪元从2016年11月1日零点开始，可以使用到2086年，工作机器ID其实就是节点ID，每个节点的ID都不相同，那么就可以区分出来，10个bit位可以表示最多1024个节点，最后12位就是每个节点下的序列号，因此每台机器每毫秒就可以有4096个系列号。

这样，它就兼具了上面所说的唯一性和有序性了，但是依然是有缺点的，第一个是时间问题，如果机器时间出现倒退，那么就会导致生成重复的ID，并且节点容量只有1024个，如果是超大规模集群，也是存在隐患的。

